/*********************************************************************************
 * Copyright (C) 2013-2017, Shenzhen Huiding Technology Co., Ltd.
 * All Rights Reserved.
 * Version:
 * Description:
 * History:
 ** --------------------------- Revision History: --------------------------------
 **  <author>      <data>            <desc>
 **  Long.Liu     2019/02/11        modify for coverity
 ********************************************************************************/

#include"gf_error.h"

// string error definition
gf_strerror_t err_table[ ] =
{
    { GF_SUCCESS, "GF_SUCCESS" },
    { GF_ERROR_BASE, "GF_ERROR_BASE" },
    { GF_ERROR_OUT_OF_MEMORY, "GF_ERROR_OUT_OF_MEMORY" },
    { GF_ERROR_OPEN_TA_FAILED, "GF_ERROR_OPEN_TA_FAILED" },
    { GF_ERROR_BAD_PARAMS, "GF_ERROR_BAD_PARAMS" },
    { GF_ERROR_NO_SPACE, "GF_ERROR_NO_SPACE" },
    { GF_ERROR_REACH_FINGERS_UPLIMIT, "GF_ERROR_REACH_FINGERS_UPLIMIT" },
    { GF_ERROR_NOT_MATCH, "GF_ERROR_NOT_MATCH" },
    { GF_ERROR_CANCELED, "GF_ERROR_CANCELED" },
    { GF_ERROR_TIMEOUT, "GF_ERROR_TIMEOUT" },
    { GF_ERROR_PREPROCESS_FAILED, "GF_ERROR_PREPROCESS_FAILED" },
    { GF_ERROR_GENERIC, "GF_ERROR_GENERIC" },
    { GF_ERROR_ACQUIRED_PARTIAL, "GF_ERROR_ACQUIRED_PARTIAL" },
    { GF_ERROR_ACQUIRED_IMAGER_DIRTY, "GF_ERROR_ACQUIRED_IMAGER_DIRTY" },
    { GF_ERROR_DUPLICATE_FINGER, "GF_ERROR_DUPLICATE_FINGER" },
    { GF_ERROR_OPEN_DEVICE_FAILED, "GF_ERROR_OPEN_DEVICE_FAILED" },
    { GF_ERROR_HAL_GENERAL_ERROR, "GF_ERROR_HAL_GENERAL_ERROR" },
    { GF_ERROR_HAL_FILE_DESCRIPTION_NULL, "GF_ERROR_HAL_FILE_DESCRIPTION_NULL" },
    { GF_ERROR_HAL_IOCTL_FAILED, "GF_ERROR_HAL_IOCTL_FAILED" },
    { GF_ERROR_HAL_TIMER_FUNC, "GF_ERROR_HAL_TIMER_FUNC" },
    { GF_ERROR_CORRUPT_CONTENT, "GF_ERROR_CORRUPT_CONTENT" },
    { GF_ERROR_INCORRECT_VERSION, "GF_ERROR_INCORRECT_VERSION" },
    { GF_ERROR_CORRUPT_OBJECT, "GF_ERROR_CORRUPT_OBJECT" },
    { GF_ERROR_INVALID_DATA, "GF_ERROR_INVALID_DATA" },
    { GF_ERROR_SPI_TRANSFER_ERROR, "GF_ERROR_SPI_TRANSFER_ERROR" },
    { GF_ERROR_SPI_GENERAL_ERROR, "GF_ERROR_SPI_GENERAL_ERROR" },
    { GF_ERROR_SPI_IRQ_HANDLE, "GF_ERROR_SPI_IRQ_HANDLE" },
    { GF_ERROR_SPI_RAW_DATA_CRC_FAILED, "GF_ERROR_SPI_RAW_DATA_CRC_FAILED" },
    { GF_ERROR_SPI_RAW_DATA_BUF_BUSY, "GF_ERROR_SPI_RAW_DATA_BUF_BUSY" },
    { GF_ERROR_SPI_FW_CFG_DATA_ERROR, "GF_ERROR_SPI_FW_CFG_DATA_ERROR" },
    { GF_ERROR_SPI_FW_DOWNLOAD_FAILED, "GF_ERROR_SPI_FW_DOWNLOAD_FAILED" },
    { GF_ERROR_SPI_CFG_DOWNLOAD_FAILED, "GF_ERROR_SPI_CFG_DOWNLOAD_FAILED" },
    { GF_ERROR_SAVE_FP_TEMPLATE, "GF_ERROR_SAVE_FP_TEMPLATE" },
    { GF_ERROR_FP_BUSY, "GF_ERROR_FP_BUSY" },
    { GF_ERROR_OPEN_SECURE_OBJECT_FAILED, "GF_ERROR_OPEN_SECURE_OBJECT_FAILED" },
    { GF_ERROR_READ_SECURE_OBJECT_FAILED, "GF_ERROR_READ_SECURE_OBJECT_FAILED" },
    { GF_ERROR_WRITE_SECURE_OBJECT_FAILED, "GF_ERROR_WRITE_SECURE_OBJECT_FAILED" },
    { GF_ERROR_DELETE_SECURE_OBJECT_FAILED, "GF_ERROR_DELETE_SECURE_OBJECT_FAILED" },
    { GF_ERROR_SECURE_OBJECT_NOT_EXIST, "GF_ERROR_SECURE_OBJECT_NOT_EXIST" },
    { GF_ERROR_WRITE_CONFIG_FAILED, "GF_ERROR_WRITE_CONFIG_FAILED" },
    { GF_ERROR_TEST_SENSOR_FAILED, "GF_ERROR_TEST_SENSOR_FAILED" },
    { GF_ERROR_SET_MODE_FAILED, "GF_ERROR_SET_MODE_FAILED" },
    { GF_ERROR_CHIP_ID_NOT_CORRECT, "GF_ERROR_CHIP_ID_NOT_CORRECT" },
    { GF_ERROR_MAX_NUM, "GF_ERROR_MAX_NUM" },
    { GF_ERROR_TEST_BAD_POINT_FAILED, "GF_ERROR_TEST_BAD_POINT_FAILED" },
    { GF_ERROR_TEST_FRR_FAR_ENROLL_DIFFERENT_FINGER,  "GF_ERROR_TEST_FRR_FAR_ENROLL_DIFFERENT_FINGER" },
    { GF_ERROR_DUPLICATE_AREA, "GF_ERROR_DUPLICATE_AREA" },
    { GF_ERROR_SPI_COMMUNICATION, "GF_ERROR_SPI_COMMUNICATION" },
    { GF_ERROR_FINGER_NOT_EXIST, "GF_ERROR_FINGER_NOT_EXIST" },
    { GF_ERROR_INVALID_PREPROCESS_VERSION, "GF_ERROR_INVALID_PREPROCESS_VERSION" },
    { GF_ERROR_TA_DEAD, "GF_ERROR_TA_DEAD" },
    { GF_ERROR_NAV_TOO_FAST, "GF_ERROR_NAV_TOO_FAST" },
    { GF_ERROR_UNSUPPORT_CHIP, "GF_ERROR_UNSUPPORT_CHIP" },
    { GF_ERROR_INVALID_FINGER_PRESS, "GF_ERROR_INVALID_FINGER_PRESS" },
    { GF_ERROR_TA_GENERATE_RANDOM, "GF_ERROR_TA_GENERATE_RANDOM" },
    { GF_ERROR_BIO_ASSAY_FAIL, "GF_ERROR_BIO_ASSAY_FAIL" },
    { GF_ERROR_INVALID_HAT_VERSION, "GF_ERROR_INVALID_HAT_VERSION" },
    { GF_ERROR_INVALID_CHALLENGE, "GF_ERROR_INVALID_CHALLENGE" },
    { GF_ERROR_UNTRUSTED_ENROLL, "GF_ERROR_UNTRUSTED_ENROLL" },
    { GF_ERROR_INVALID_BASE, "GF_ERROR_INVALID_BASE" },
    { GF_ERROR_SENSOR_BROKEN_CHECK_NEXT_FRAME, "GF_ERROR_SENSOR_BROKEN_CHECK_NEXT_FRAME" },
    { GF_ERROR_SENSOR_BROKEN_CHECK_ALGO_ERROR, "GF_ERROR_SENSOR_BROKEN_CHECK_ALGO_ERROR" },
    { GF_ERROR_SENSOR_IS_BROKEN, "GF_ERROR_SENSOR_IS_BROKEN" },
    { GF_ERROR_SENSOR_NOT_AVAILABLE, "GF_ERROR_SENSOR_NOT_AVAILABLE" },
    { GF_ERROR_SENSOR_TEST_FAILED, "GF_ERROR_SENSOR_TEST_FAILED" },
    { GF_ERROR_MATCH_FAIL_AND_RETRY, "GF_ERROR_MATCH_FAIL_AND_RETRY" },
    { GF_ERROR_FINGER_NOT_LEAVE, "GF_ERROR_FINGER_NOT_LEAVE" },
    { GF_ERROR_GET_TEMPERATURE_FAILED, "GF_ERROR_GET_TEMPERATURE_FAILED" },
    { GF_ERROR_GET_OTP_INFO_FAILED, "GF_ERROR_GET_OTP_INFO_FAILED" },
    { GF_ERROR_TEST_RESET_PIN, "GF_ERROR_TEST_RESET_PIN" },
    { GF_ERROR_TEST_INTERRUPT_PIN, "GF_ERROR_TEST_INTERRUPT_PIN" },
    { GF_ERROR_UNKNOWN_CMD, "GF_ERROR_UNKNOWN_CMD" },
    { GF_ERROR_TEST_SPI_TRANSFER_TIMEOUT, "GF_ERROR_TEST_SPI_TRANSFER_TIMEOUT" },
    { GF_ERROR_ENCODE_TLV, "GF_ERROR_ENCODE_TLV" },
    { GF_ERROR_INVALID_FP_ID, "GF_ERROR_INVALID_FP_ID" },
    { GF_ERROR_NATIVE_SERVICE_BASE, "GF_ERROR_NATIVE_SERVICE_BASE" },
    { GF_ERROR_NATIVE_SERVICE_GETSERVICE, "GF_ERROR_NATIVE_SERVICE_GETSERVICE" },
    { GF_ERROR_NATIVE_SERVICE_INIT_HAL, "GF_ERROR_NATIVE_SERVICE_INIT_HAL" },
    { GF_ERROR_MKDIR_FAILED, "GF_ERROR_MKDIR_FAILED" },
    { GF_ERROR_FILE_OPEN_FAILED, "GF_ERROR_FILE_OPEN_FAILED" },
    { GF_ERROR_FILE_NOT_EXIST, "GF_ERROR_FILE_NOT_EXIST" },
    { GF_ERROR_FILE_READ_FAILED, "GF_ERROR_FILE_READ_FAILED" },
    { GF_ERROR_FILE_WRITE_FAILED, "GF_ERROR_FILE_WRITE_FAILED" },
    { GF_ERROR_FILE_DELETE_FAILED, "GF_ERROR_FILE_DELETE_FAILED" },
    { GF_ERROR_TOO_MUCH_UNDER_SATURATED_PIXELS, "GF_ERROR_TOO_MUCH_UNDER_SATURATED_PIXELS" },
    { GF_ERROR_TOO_MUCH_OVER_SATURATED_PIXELS, "GF_ERROR_TOO_MUCH_OVER_SATURATED_PIXELS" },
    { GF_ERROR_SENSOR_HAS_CHANGED, "GF_ERROR_SENSOR_HAS_CHANGED" },
    { GF_ERROR_OPEN_SESSION_FAILED, "GF_ERROR_OPEN_SESSION_FAILED" },
    { GF_ERROR_FACTORY_TEST_FAILED, "GF_ERROR_FACTORY_TEST_FAILED" },
    { GF_ERROR_NO_GROUP_ID, "GF_ERROR_NO_GROUP_ID" },
    { GF_ERROR_UNKNOWN_TEST_TOKEN, "GF_ERROR_UNKNOWN_TEST_TOKEN" },
    { GF_FINGER_FEATURE_STUDY_FAILED, "GF_FINGER_FEATURE_STUDY_FAILED" },
    { GF_ERROR_INVALID_OTP_VERSION, "GF_ERROR_INVALID_OTP_VERSION" },
    { GF_ERROR_CALIBRATION_NOT_READY, "GF_ERROR_CALIBRATION_NOT_READY"},
    { GF_ERROR_ALGO_INVALID_DATA, "GF_ERROR_ALGO_INVALID_DATA" },
    { GF_ERROR_TOO_FAST, "GF_ERROR_TOO_FAST" },
    { GF_ERROR_TEST_NOT_SUPPORTED, "GF_ERROR_TEST_NOT_SUPPORTED" },
    { GF_ERROR_NO_NEED_UPDATE_BASE, "GF_ERROR_NO_NEED_UPDATE_BASE" },
    { GF_ERROR_OTP_CHECK_FAIL, "GF_ERROR_OTP_CHECK_FAIL" },
    { GF_ERROR_INIT_ALGO_REGISTER_INFO, "GF_ERROR_INIT_ALGO_REGISTER_INFO" },
    { GF_ERROR_DYNAMIC_ENROLL_INVALID_PRESS_TOO_MUCH, "GF_ERROR_DYNAMIC_ENROLL_INVALID_PRESS_TOO_MUCH" },
    { GF_ERROR_DYNAMIC_ERNOLL_INCOMPLETE_TEMPLATE, "GF_ERROR_DYNAMIC_ERNOLL_INCOMPLETE_TEMPLATE" },
    { GF_ERROR_ALGO_DIRTY_FINGER, "GF_ERROR_ALGO_DIRTY_FINGER" },
    { GF_ERROR_PREPROCESS_FAIL_AND_RETRY, "GF_ERROR_PREPROCESS_FAIL_AND_RETRY" },
    { GF_ERROR_CRC_CHECK_FAILED_AND_RETRY, "GF_ERROR_CRC_CHECK_FAILED_AND_RETRY" },
    { GF_ERROR_ALGO_COVER_BROKEN, "GF_ERROR_ALGO_COVER_BROKEN" },
    { GF_ERROR_SENSOR_ID_NOT_CHANGED, "GF_ERROR_SENSOR_ID_NOT_CHANGED" },
    { GF_ERROR_FARGO_CHIP_ID_NOT_CORRECT, "GF_ERROR_FARGO_CHIP_ID_NOT_CORRECT"},
    { GF_ERROR_NEED_RESET, "GF_ERROR_NEED_RESET"},
    { GF_ERROR_WRONG_REG_VALUE, "GF_ERROR_WRONG_REG_VALUE"},
    { GF_ERROR_ALGO_PALM_DETECT, "GF_ERROR_ALGO_PALM_DETECT"},
    { GF_ERROR_FDT_RET_BAD, "GF_ERROR_FDT_RET_BAD"},
    { GF_ERROR_FDT_RET_BASE_BAD, "GF_ERROR_FDT_RET_BASE_BAD"},
    { GF_ERROR_FDT_RET_CUR_BAD, "GF_ERROR_FDT_RET_CUR_BAD"},
    { GF_ERROR_FDT_RET_TEMP, "GF_ERROR_FDT_RET_TEMP"},
    { GF_ERROR_FDT_RET_VOID, "GF_ERROR_FDT_RET_VOID"},
    { GF_ERROR_FDT_RET_FOREIGN, "GF_ERROR_FDT_RET_FOREIGN"},
    { GF_ERROR_TOO_SLOW, "GF_ERROR_TOO_SLOW"},
    { GF_ERROR_OVER_CURRENT, "GF_ERROR_OVER_CURRENT"},
    { GF_ERROR_ALGO_FAKE, "GF_ERROR_ALGO_FAKE"},
    { GF_ERROR_ENROLL_TIMEOUT, "GF_ERROR_ENROLL_TIMEOUT"},
    { GF_ERROR_MAX, "INVALID_ERROR" }
};

/**
 * Function: gf_strerror
 * Description: get error string
 * Input: error code
 * Output: none
 * Return: error string
 */
const char *gf_strerror(const gf_error_t err)
{
    // need error is consequent 0 ,1000, 1001, 1002,...,max
    uint32_t idx = 0;
    uint32_t len = sizeof(err_table) / sizeof(gf_strerror_t);

    do
    {
        if (GF_SUCCESS == err)
        {
            break;
        }

        if ((err < GF_ERROR_BASE) || (err > GF_ERROR_MAX)
            || (err - GF_ERROR_BASE + 1 >= len))
        {
            idx = len - 1;
            break;
        }

        if (err == err_table[err - GF_ERROR_BASE + 1].err)
        {
            idx = err - GF_ERROR_BASE + 1;
            break;
        }

        while (idx < len)
        {
            if (err == err_table[idx].err)
            {
                break;
            }

            idx++;
        }

        if (idx == len)
        {
            idx = len - 1;
        }
    }  // do...
    while (0);

    return err_table[idx].strerror;
}

/**
 * Function: gf_get_err_table_len
 * Description: get error table length
 * Input: none
 * Output: none
 * Return: error table length
 */
uint32_t gf_get_err_table_len(void)
{
    uint32_t len = sizeof(err_table) / sizeof(gf_strerror_t);
    return len;
}
